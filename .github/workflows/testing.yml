name: Tests

on:
  pull_request:
    branches: [ "main" ]

jobs:

  test:

    runs-on: ubuntu-latest

    steps:
    
    - name: ðŸ›Ž Checkout
      uses: actions/checkout@v3

    - name: ðŸ’¾ Cache Godot
      id: cache-gd
      uses: actions/cache@v3
      with:
        # Change key on Godot update
        path: Godot_v3.4.4-stable_linux_server.64
        key: ${{ runner.os }}-gd-3.4.4
    
    - name: ðŸ“¦ Download Godot if cache miss
      if: steps.cache-gd.outputs.cache-hit != 'true'
      # Change URL on Godot update
      run: wget https://downloads.tuxfamily.org/godotengine/3.4.4/Godot_v3.4.4-stable_linux_server.64.zip && unzip Godot_v3.4.4-stable_linux_server.64.zip

    - name: ðŸ’¾ Cache Gut
      id: cache-gut
      uses: actions/cache@v3
      with:
        path: addons
        # Change key on Gut update
        key: ${{ runner.os }}-gut-7.3.0

    - name: ðŸ“¦ Download Gut if cache miss
      if: steps.cache-gut.outputs.cache-hit != 'true'
      # Change URL on Gut update
      run: wget https://github.com/bitwes/Gut/archive/refs/tags/v7.3.0.zip && unzip v7.3.0.zip && mv Gut-7.3.0/addons addons

    - name: ðŸ§ª Run tests
      # Change command on Godot update
      run: ./Godot_v3.4.4-stable_linux_server.64 -d -q -s addons/gut/gut_cmdln.gd